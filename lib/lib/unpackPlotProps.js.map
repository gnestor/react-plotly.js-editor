{"version":3,"sources":["../../src/lib/unpackPlotProps.js"],"names":["unpackPlotProps","props","context","container","getValObject","defaultContainer","updateContainer","attr","attrMeta","fullContainer","_fullInput","type","fullProperty","fullValue","get","multiValued","isVisible","show","defaultValue","min","max","updatePlot","v"],"mappings":";;;;;kBAIwBA,e;;AAJxB;;;;AACA;;;;AACA;;;;;;AAEe,SAASA,eAAT,CAAyBC,KAAzB,EAAgCC,OAAhC,EAAyC;AAAA,MAC/CC,SAD+C,GACeD,OADf,CAC/CC,SAD+C;AAAA,MACpCC,YADoC,GACeF,OADf,CACpCE,YADoC;AAAA,MACtBC,gBADsB,GACeH,OADf,CACtBG,gBADsB;AAAA,MACJC,eADI,GACeJ,OADf,CACJI,eADI;;;AAGtD,MAAI,CAACL,MAAMM,IAAX,EAAiB;AACf,WAAO,EAAP;AACD;;AAED,MAAIC,iBAAJ;AACA,MAAIJ,YAAJ,EAAkB;AAChBI,eAAWN,QAAQE,YAAR,CAAqBH,MAAMM,IAA3B,KAAoC,EAA/C;AACD;;AAED;;;;;;AAMA,MAAIE,gBAAgBP,QAAQO,aAA5B;AACA,MACEA,iBACAA,cAAcC,UADd,KAECD,cAAcC,UAAd,CAAyBC,IAAzB,KAAkC,MAAlC,IACCF,cAAcC,UAAd,CAAyBC,IAAzB,KAAkC,aAHpC,CADF,EAKE;AACAF,oBAAgBA,cAAcC,UAA9B;AACD;;AAED,MAAME,eAAe,+BAAeH,aAAf,EAA8BR,MAAMM,IAApC,CAArB;AACA,MAAIM,YAAYD,aAAaE,GAAb,EAAhB;AACA,MAAIC,cAAc,KAAlB;;AAEA;AACA;AACA;AACA,MAAIF,qCAAJ,EAAgC;AAC9BA;AACAE,kBAAc,IAAd;AACD;;AAED,MAAIC,YAAY,KAAhB;AACA,MAAIf,MAAMgB,IAAN,IAAeJ,cAAc,KAAK,CAAnB,IAAwBA,cAAc,IAAzD,EAAgE;AAC9DG,gBAAY,IAAZ;AACD;;AAED,MAAIE,eAAejB,MAAMiB,YAAzB;AACA,MAAIA,iBAAiB,KAAK,CAAtB,IAA2Bb,gBAA/B,EAAiD;AAC/Ca,mBAAe,+BAAeb,gBAAf,EAAiCJ,MAAMM,IAAvC,EAA6CO,GAA7C,EAAf;AACD;;AAED,MAAIK,YAAJ;AAAA,MAASC,YAAT;AACA,MAAIZ,QAAJ,EAAc;AACZ,QAAI,6BAAUA,SAASY,GAAnB,CAAJ,EAA6B;AAC3BA,YAAMZ,SAASY,GAAf;AACD;AACD,QAAI,6BAAUZ,SAASW,GAAnB,CAAJ,EAA6B;AAC3BA,YAAMX,SAASW,GAAf;AACD;AACF;;AAED,MAAME,aAAa,SAAbA,UAAa,IAAK;AACtB,QAAIf,eAAJ,EAAqB;AACnBA,0CAAkBL,MAAMM,IAAxB,EAA+Be,CAA/B;AACD;AACF,GAJD;;AAMA,SAAO;AACLd,sBADK;AAELL,wBAFK;AAGLe,8BAHK;AAILT,gCAJK;AAKLI,wBALK;AAMLT,8BANK;AAOLY,wBAPK;AAQLI,YARK;AASLD,YATK;AAULJ,4BAVK;AAWLT,oCAXK;AAYLe;AAZK,GAAP;AAcD","file":"unpackPlotProps.js","sourcesContent":["import nestedProperty from 'plotly.js/src/lib/nested_property';\nimport isNumeric from 'fast-isnumeric';\nimport {MULTI_VALUED, MULTI_VALUED_PLACEHOLDER} from './constants';\n\nexport default function unpackPlotProps(props, context) {\n  const {container, getValObject, defaultContainer, updateContainer} = context;\n\n  if (!props.attr) {\n    return {};\n  }\n\n  let attrMeta;\n  if (getValObject) {\n    attrMeta = context.getValObject(props.attr) || {};\n  }\n\n  /*\n   * This needed to be adjusted as financial charts\n   * do not contain their 'true' attributes, but rather attributes of the trace\n   * types that are used to compose them. Financial chart attributes are found in\n   * fullContainer._fullInput\n   */\n  let fullContainer = context.fullContainer;\n  if (\n    fullContainer &&\n    fullContainer._fullInput &&\n    (fullContainer._fullInput.type === 'ohlc' ||\n      fullContainer._fullInput.type === 'candlestick')\n  ) {\n    fullContainer = fullContainer._fullInput;\n  }\n\n  const fullProperty = nestedProperty(fullContainer, props.attr);\n  let fullValue = fullProperty.get();\n  let multiValued = false;\n\n  // MULTI_VALUED consists of a control sequence that cannot be confused with\n  // user data. We must transform it into something that can be displayed as\n  // the screen.\n  if (fullValue === MULTI_VALUED) {\n    fullValue = MULTI_VALUED_PLACEHOLDER;\n    multiValued = true;\n  }\n\n  let isVisible = false;\n  if (props.show || (fullValue !== void 0 && fullValue !== null)) {\n    isVisible = true;\n  }\n\n  let defaultValue = props.defaultValue;\n  if (defaultValue === void 0 && defaultContainer) {\n    defaultValue = nestedProperty(defaultContainer, props.attr).get();\n  }\n\n  let min, max;\n  if (attrMeta) {\n    if (isNumeric(attrMeta.max)) {\n      max = attrMeta.max;\n    }\n    if (isNumeric(attrMeta.min)) {\n      min = attrMeta.min;\n    }\n  }\n\n  const updatePlot = v => {\n    if (updateContainer) {\n      updateContainer({[props.attr]: v});\n    }\n  };\n\n  return {\n    attrMeta,\n    container,\n    defaultValue,\n    fullContainer,\n    fullValue,\n    getValObject,\n    isVisible,\n    max,\n    min,\n    multiValued,\n    updateContainer,\n    updatePlot,\n  };\n}\n"]}