{"version":3,"sources":["../../../src/components/containers/Panel.js"],"names":["PanelErrorImpl","_","props","localize","propTypes","func","PanelError","Panel","state","individualFoldStates","hasError","toggleFolds","bind","toggleFold","setState","hasOpen","length","some","s","map","index","$toggle","numFolds","Children","forEach","children","child","type","plotly_editor_traits","foldable","newFoldStates","Array","fill","addAction","e","i","calculateFolds","newChildren","key","folded","noPadding","showExpandCollapse","node","object","bool","defaultProps","contextTypes","layout","onUpdate","updateContainer"],"mappings":"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","file":"Panel.js","sourcesContent":["import PanelHeader from './PanelHeader';\nimport PanelEmpty from './PanelEmpty';\nimport PropTypes from 'prop-types';\nimport React, {Component, cloneElement} from 'react';\nimport update from 'immutability-helper';\nimport {bem, localize} from 'lib';\nimport {EmbedIconIcon} from 'plotly-icons';\n\nclass PanelErrorImpl extends Component {\n  render() {\n    const {localize: _} = this.props;\n\n    return (\n      <PanelEmpty\n        icon={EmbedIconIcon}\n        heading={_('Well this is embarrassing.')}\n        message={_('This panel could not be displayed due to an error.')}\n      />\n    );\n  }\n}\n\nPanelErrorImpl.propTypes = {\n  localize: PropTypes.func,\n};\n\nconst PanelError = localize(PanelErrorImpl);\n\nclass Panel extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      individualFoldStates: [],\n      hasError: false,\n    };\n    this.toggleFolds = this.toggleFolds.bind(this);\n    this.toggleFold = this.toggleFold.bind(this);\n  }\n\n  componentDidCatch() {\n    this.setState({hasError: true});\n  }\n\n  toggleFolds() {\n    const {individualFoldStates} = this.state;\n    const hasOpen =\n      individualFoldStates.length > 0 &&\n      individualFoldStates.some(s => s !== true);\n    this.setState({\n      individualFoldStates: individualFoldStates.map(() => hasOpen),\n    });\n  }\n\n  toggleFold(index) {\n    this.setState(\n      update(this.state, {individualFoldStates: {$toggle: [index]}})\n    );\n  }\n\n  calculateFolds() {\n    // to get proper number of child folds and initialize component state\n    let numFolds = 0;\n\n    React.Children.forEach(this.props.children, child => {\n      if ((child.type.plotly_editor_traits || {}).foldable) {\n        numFolds++;\n      }\n    });\n\n    if (this.state.individualFoldStates.length !== numFolds) {\n      const newFoldStates = new Array(numFolds).fill(false);\n      this.setState({\n        individualFoldStates: this.props.addAction\n          ? newFoldStates.map((e, i) => i !== numFolds - 1)\n          : newFoldStates,\n      });\n    }\n  }\n\n  componentDidUpdate() {\n    this.calculateFolds();\n  }\n  componentDidMount() {\n    this.calculateFolds();\n  }\n\n  render() {\n    const {individualFoldStates, hasError} = this.state;\n\n    if (hasError) {\n      return <PanelError />;\n    }\n\n    const newChildren = React.Children.map(\n      this.props.children,\n      (child, index) => {\n        if ((child.type.plotly_editor_traits || {}).foldable) {\n          return cloneElement(child, {\n            key: index,\n            folded: individualFoldStates[index] || false,\n            toggleFold: () => this.toggleFold(index),\n          });\n        }\n        return child;\n      }\n    );\n\n    return (\n      <div\n        className={`panel${this.props.noPadding ? ' panel--no-padding' : ''}`}\n      >\n        <PanelHeader\n          addAction={this.props.addAction}\n          allowCollapse={\n            this.props.showExpandCollapse && individualFoldStates.length > 1\n          }\n          toggleFolds={this.toggleFolds}\n          hasOpen={individualFoldStates.some(s => s === false)}\n        />\n        <div className={bem('panel', 'content')}>{newChildren}</div>\n      </div>\n    );\n  }\n}\n\nPanel.propTypes = {\n  children: PropTypes.node,\n  addAction: PropTypes.object,\n  showExpandCollapse: PropTypes.bool,\n  noPadding: PropTypes.bool,\n};\n\nPanel.defaultProps = {\n  showExpandCollapse: true,\n};\n\nPanel.contextTypes = {\n  layout: PropTypes.object,\n  onUpdate: PropTypes.func,\n  updateContainer: PropTypes.func,\n};\n\nexport default Panel;\n"]}