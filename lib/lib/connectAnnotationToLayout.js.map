{"version":3,"sources":["../../src/lib/connectAnnotationToLayout.js"],"names":["connectAnnotationToLayout","WrappedComponent","AnnotationConnectedComponent","props","context","deleteAnnotation","bind","updateAnnotation","setLocals","nextProps","nextContext","annotationIndex","container","fullContainer","annotations","fullAnnotations","updateContainer","deleteContainer","update","newUpdate","key","newkey","onUpdate","type","DELETE_ANNOTATION","payload","displayName","propTypes","number","isRequired","contextTypes","object","data","array","func","childContextTypes","plotly_editor_traits"],"mappings":"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","file":"connectAnnotationToLayout.js","sourcesContent":["import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {getDisplayName} from '../lib';\nimport {EDITOR_ACTIONS} from './constants';\n\nexport default function connectAnnotationToLayout(WrappedComponent) {\n  class AnnotationConnectedComponent extends Component {\n    constructor(props, context) {\n      super(props, context);\n\n      this.deleteAnnotation = this.deleteAnnotation.bind(this);\n      this.updateAnnotation = this.updateAnnotation.bind(this);\n      this.setLocals(props, context);\n    }\n\n    componentWillReceiveProps(nextProps, nextContext) {\n      this.setLocals(nextProps, nextContext);\n    }\n\n    setLocals(props, context) {\n      const {annotationIndex} = props;\n      const {container, fullContainer} = context;\n\n      const annotations = container.annotations || [];\n      const fullAnnotations = fullContainer.annotations || [];\n      this.container = annotations[annotationIndex];\n      this.fullContainer = fullAnnotations[annotationIndex];\n    }\n\n    getChildContext() {\n      return {\n        updateContainer: this.updateAnnotation,\n        deleteContainer: this.deleteAnnotation,\n        container: this.container,\n        fullContainer: this.fullContainer,\n      };\n    }\n\n    updateAnnotation(update) {\n      const newUpdate = {};\n      const {annotationIndex} = this.props;\n      for (const key in update) {\n        const newkey = `annotations[${annotationIndex}].${key}`;\n        newUpdate[newkey] = update[key];\n      }\n      this.context.updateContainer(newUpdate);\n    }\n\n    deleteAnnotation() {\n      if (this.context.onUpdate) {\n        this.context.onUpdate({\n          type: EDITOR_ACTIONS.DELETE_ANNOTATION,\n          payload: {annotationIndex: this.props.annotationIndex},\n        });\n      }\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  }\n\n  AnnotationConnectedComponent.displayName = `AnnotationConnected${getDisplayName(\n    WrappedComponent\n  )}`;\n\n  AnnotationConnectedComponent.propTypes = {\n    annotationIndex: PropTypes.number.isRequired,\n  };\n\n  AnnotationConnectedComponent.contextTypes = {\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    data: PropTypes.array,\n    onUpdate: PropTypes.func,\n    updateContainer: PropTypes.func,\n  };\n\n  AnnotationConnectedComponent.childContextTypes = {\n    updateContainer: PropTypes.func,\n    deleteContainer: PropTypes.func,\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n  };\n\n  const {plotly_editor_traits} = WrappedComponent;\n  AnnotationConnectedComponent.plotly_editor_traits = plotly_editor_traits;\n\n  return AnnotationConnectedComponent;\n}\n"]}